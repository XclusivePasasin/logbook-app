import{b as J,C as P,r as i,z as K,d as I,e as l,w as a,v as o,D,f as c,A as b,o as _,q as z,G as O,F as Q,B as W,H as X,E as k,h as u,y as w,I as C,k as n,J as d,M as Y,s as g}from"./app-BcChn2R6.js";import{u as Z,b as ee}from"./index-BNShoDAj.js";const ae={class:"users-list"},le={style:{display:"flex","justify-content":"space-between","align-items":"center"}},te={style:{display:"flex","justify-content":"space-between"}},se={style:{display:"flex","justify-content":"space-between"}},ue={__name:"UsersList",setup(oe){const m=J(),M=P(),B=Z(ee).smaller("md"),E=i([]),U=i(!1),v=i(!1),N=i(!1),R=i(null),f=i(!1),x=i(null),r=i({name:"",email:"",password:"",role:"user",is_active:!0}),T={name:{required:!0,message:"Requerido",trigger:["blur","change"]},email:{required:!0,message:"Requerido",trigger:["blur","change"]},role:{required:!0,message:"Requerido",trigger:["blur","change"]}},$=[{title:"Nombre",key:"name"},{title:"Email",key:"email"},{title:"Rol",key:"role",render(t){return g(C,{type:t.role==="admin"?"warning":"default"},{default:()=>t.role.toUpperCase()})}},{title:"Estado",key:"is_active",render(t){return g(C,{type:t.is_active?"success":"error"},{default:()=>t.is_active?"Activo":"Inactivo"})}},{title:"Acciones",key:"actions",render(t){return g(k,null,{default:()=>[g(d,{size:"small",onClick:()=>j(t)},{default:()=>"Editar"}),g(d,{size:"small",type:"error",onClick:()=>A(t)},{default:()=>"Eliminar"})]})}}];async function h(){U.value=!0;try{const t=await b.get("/users");E.value=t.data}catch{m.error("Error al cargar usuarios")}finally{U.value=!1}}function G(){f.value=!1,x.value=null,r.value={name:"",email:"",password:"",role:"user",is_active:!0},v.value=!0}function j(t){f.value=!0,x.value=t.id,r.value={name:t.name,email:t.email,password:"",role:t.role,is_active:!!t.is_active},v.value=!0}async function S(){var t;(t=R.value)==null||t.validate(async e=>{if(!e){N.value=!0;try{if(f.value){const p={...r.value};p.password||delete p.password,await b.put(`/users/${x.value}`,p),m.success("Usuario actualizado")}else await b.post("/users",r.value),m.success("Usuario creado");v.value=!1,h()}catch{m.error("Error al guardar")}finally{N.value=!1}}})}function A(t){M.warning({title:"Confirmar eliminación",content:"¿Estás seguro de que deseas eliminar este usuario?",positiveText:"Eliminar",negativeText:"Cancelar",onPositiveClick:async()=>{try{await b.delete(`/users/${t.id}`),m.success("Usuario eliminado"),h()}catch{m.error("Error al eliminar usuario")}}})}return K(()=>{h()}),(t,e)=>{const p=c("n-data-table"),q=c("n-input"),y=c("n-form-item"),V=c("n-select"),F=c("n-form"),L=c("n-modal");return _(),I("div",ae,[l(o(D),{title:"Usuarios"},{"header-extra":a(()=>[l(o(d),{type:"primary",onClick:G},{default:a(()=>[...e[7]||(e[7]=[n(" Nuevo Usuario ",-1)])]),_:1})]),default:a(()=>[o(B)?(_(),z(o(O),{key:0,cols:"1","y-gap":12},{default:a(()=>[(_(!0),I(Q,null,W(E.value,s=>(_(),z(o(X),{key:s.id},{default:a(()=>[l(o(D),{size:"small"},{header:a(()=>[u("div",le,[u("strong",null,w(s.name),1),l(o(C),{type:s.role==="admin"?"warning":"default"},{default:a(()=>[n(w(s.role.toUpperCase()),1)]),_:2},1032,["type"])])]),action:a(()=>[l(o(k),{justify:"end"},{default:a(()=>[l(o(d),{size:"small",onClick:H=>j(s)},{default:a(()=>[...e[10]||(e[10]=[n(" Editar ",-1)])]),_:1},8,["onClick"]),l(o(d),{size:"small",type:"error",onClick:H=>A(s)},{default:a(()=>[...e[11]||(e[11]=[n(" Eliminar ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[l(o(k),{vertical:"",size:"small"},{default:a(()=>[u("div",te,[e[8]||(e[8]=u("span",{style:{color:"#999"}},"Email:",-1)),u("span",null,w(s.email),1)]),u("div",se,[e[9]||(e[9]=u("span",{style:{color:"#999"}},"Estado:",-1)),l(o(C),{type:s.is_active?"success":"error"},{default:a(()=>[n(w(s.is_active?"Activo":"Inactivo"),1)]),_:2},1032,["type"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(_(),z(p,{key:1,columns:$,data:E.value,loading:U.value},null,8,["data","loading"]))]),_:1}),l(L,{show:v.value,"onUpdate:show":e[6]||(e[6]=s=>v.value=s),preset:"card",title:f.value?"Editar Usuario":"Nuevo Usuario",style:{width:"600px"}},{footer:a(()=>[l(o(k),{justify:"end"},{default:a(()=>[l(o(d),{onClick:e[5]||(e[5]=s=>v.value=!1)},{default:a(()=>[...e[14]||(e[14]=[n("Cancelar",-1)])]),_:1}),l(o(d),{type:"primary",loading:N.value,onClick:S},{default:a(()=>[...e[15]||(e[15]=[n(" Guardar ",-1)])]),_:1},8,["loading"])]),_:1})]),default:a(()=>[l(F,{ref_key:"formRef",ref:R,model:r.value,rules:T,"label-placement":o(B)?"top":"left","label-width":"120"},{default:a(()=>[l(y,{label:"Nombre",path:"name"},{default:a(()=>[l(q,{value:r.value.name,"onUpdate:value":e[0]||(e[0]=s=>r.value.name=s),placeholder:"Nombre completo"},null,8,["value"])]),_:1}),l(y,{label:"Email",path:"email"},{default:a(()=>[l(q,{value:r.value.email,"onUpdate:value":e[1]||(e[1]=s=>r.value.email=s),placeholder:"Correo electrónico"},null,8,["value"])]),_:1}),l(y,{label:"Contraseña",path:"password"},{default:a(()=>[l(q,{value:r.value.password,"onUpdate:value":e[2]||(e[2]=s=>r.value.password=s),type:"password","show-password-on":"click",placeholder:f.value?"Dejar en blanco para mantener":"Contraseña"},null,8,["value","placeholder"])]),_:1}),l(y,{label:"Rol",path:"role"},{default:a(()=>[l(V,{value:r.value.role,"onUpdate:value":e[3]||(e[3]=s=>r.value.role=s),options:[{label:"Admin",value:"admin"},{label:"Usuario",value:"user"}]},null,8,["value"])]),_:1}),l(y,{label:"Estado",path:"is_active"},{default:a(()=>[l(o(Y),{value:r.value.is_active,"onUpdate:value":e[4]||(e[4]=s=>r.value.is_active=s)},{checked:a(()=>[...e[12]||(e[12]=[n("Activo",-1)])]),unchecked:a(()=>[...e[13]||(e[13]=[n("Inactivo",-1)])]),_:1},8,["value"])]),_:1})]),_:1},8,["model","label-placement"])]),_:1},8,["show","title"])])}}};export{ue as default};
