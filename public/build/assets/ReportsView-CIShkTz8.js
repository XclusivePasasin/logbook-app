import{b as Q,r as c,K as B,c as W,z as X,d as C,e,w as t,f as o,A as E,o as d,v as F,k as N,q as _,F as R,B as U,h as r,y as p}from"./app-BcChn2R6.js";import{u as Y,b as Z}from"./index-BNShoDAj.js";const ee={class:"reports-view"},te={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ae={style:{color:"#999","font-size":"12px"}},le={style:{"font-size":"18px","font-weight":"bold",color:"#18a058"}},ne={style:{display:"flex","justify-content":"space-between","align-items":"center"}},oe={style:{color:"#999","font-size":"12px"}},se={style:{"font-size":"18px","font-weight":"bold",color:"#18a058"}},ce={__name:"ReportsView",setup(re){const k=Q(),w=Y(Z).smaller("lg"),h=c(!1),x=c(!1),u=c(B(new Date,"yyyy-MM-dd")),f=c(""),y=c("Mañana"),L=[{label:"Mañana",value:"Mañana"},{label:"Tarde",value:"Tarde"},{label:"Noche",value:"Noche"}],i=c({total_trips:0,total_amount:0,total_passengers:0,by_payment_method:[],by_driver:[]}),A=W(()=>!!(u.value&&f.value.trim()&&y.value));function T(a){return{E:"Efectivo",CH:"Cargo Hab.",TJ:"Tarjeta"}[a]||a}const O=[{title:"Método",key:"payment_method",render(a){return T(a.payment_method)}},{title:"Viajes",key:"count"},{title:"Total",key:"total",render(a){return`$${Number(a.total).toFixed(2)}`}}],G=[{title:"Conductor",key:"driver.name",render(a){var l;return((l=a.driver)==null?void 0:l.name)||"N/A"}},{title:"Viajes",key:"count"},{title:"Total",key:"total",render(a){return`$${Number(a.total).toFixed(2)}`}}];function H(a){a&&z()}async function z(){h.value=!0;try{const a={};u.value&&(a.start_date=u.value,a.end_date=u.value);const l=await E.get("/trips-report",{params:a});i.value=l.data}catch{k.error("Error al cargar reportes")}finally{h.value=!1}}async function S(){x.value=!0;try{const a={date:u.value||B(new Date,"yyyy-MM-dd"),coordinator:f.value,shift:y.value},l=await E.get("/trips-report/download",{params:a,responseType:"blob"}),b=window.URL.createObjectURL(new Blob([l.data])),s=document.createElement("a");s.href=b,s.setAttribute("download",`reporte-viajes-${a.date}.pdf`),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(b),k.success("PDF generado exitosamente")}catch{k.error("Error al generar PDF")}finally{x.value=!1}}return X(()=>{z()}),(a,l)=>{const b=o("n-date-picker"),s=o("n-form-item"),q=o("n-input"),J=o("n-select"),j=o("n-button"),g=o("n-space"),K=o("n-form"),M=o("n-statistic"),m=o("n-grid-item"),D=o("n-grid"),I=o("n-divider"),v=o("n-card"),P=o("n-data-table");return d(),C("div",ee,[e(v,{title:"Reportes y Estadísticas"},{default:t(()=>[e(g,{vertical:"",size:"large"},{default:t(()=>[e(K,{inline:!F(w),"label-placement":"left"},{default:t(()=>[e(s,{label:"Fecha"},{default:t(()=>[e(b,{"formatted-value":u.value,"onUpdate:formattedValue":[l[0]||(l[0]=n=>u.value=n),H],type:"date","value-format":"yyyy-MM-dd",clearable:"",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),e(s,{label:"Coordinador"},{default:t(()=>[e(q,{value:f.value,"onUpdate:value":l[1]||(l[1]=n=>f.value=n),placeholder:"Nombre del coordinador",style:{width:"200px"}},null,8,["value"])]),_:1}),e(s,{label:"Turno"},{default:t(()=>[e(J,{value:y.value,"onUpdate:value":l[2]||(l[2]=n=>y.value=n),options:L,placeholder:"Seleccionar turno",style:{width:"150px"}},null,8,["value"])]),_:1}),e(s,null,{default:t(()=>[e(g,null,{default:t(()=>[e(j,{type:"primary",onClick:z,loading:h.value},{default:t(()=>[...l[3]||(l[3]=[N(" Actualizar ",-1)])]),_:1},8,["loading"]),e(j,{type:"warning",onClick:S,loading:x.value,disabled:!A.value},{default:t(()=>[...l[4]||(l[4]=[N(" Generar PDF ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["inline"]),e(D,{cols:"1 s:2 m:3",responsive:"screen","x-gap":12,"y-gap":12},{default:t(()=>[e(m,null,{default:t(()=>[e(M,{label:"Total Viajes",value:i.value.total_trips},null,8,["value"])]),_:1}),e(m,null,{default:t(()=>[e(M,{label:"Monto Total",value:i.value.total_amount},{prefix:t(()=>[...l[5]||(l[5]=[N("$",-1)])]),_:1},8,["value"])]),_:1}),e(m,null,{default:t(()=>[e(M,{label:"Total Pasajeros",value:i.value.total_passengers},null,8,["value"])]),_:1})]),_:1}),e(I),e(D,{cols:"1 m:2",responsive:"screen","x-gap":24,"y-gap":24},{default:t(()=>[e(m,null,{default:t(()=>[e(v,{title:"Por Método de Pago",size:"small"},{default:t(()=>[F(w)?(d(),_(g,{key:0,vertical:"",size:"small"},{default:t(()=>[(d(!0),C(R,null,U(i.value.by_payment_method,n=>(d(),_(v,{key:n.payment_method,size:"small"},{default:t(()=>[r("div",te,[r("div",null,[r("strong",null,p(T(n.payment_method)),1),r("div",ae,p(n.count)+" viajes",1)]),r("div",le," $"+p(Number(n.total).toFixed(2)),1)])]),_:2},1024))),128))]),_:1})):(d(),_(P,{key:1,columns:O,data:i.value.by_payment_method,size:"small"},null,8,["data"]))]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(v,{title:"Por Conductor",size:"small"},{default:t(()=>[F(w)?(d(),_(g,{key:0,vertical:"",size:"small"},{default:t(()=>[(d(!0),C(R,null,U(i.value.by_driver,n=>{var V;return d(),_(v,{key:(V=n.driver)==null?void 0:V.id,size:"small"},{default:t(()=>{var $;return[r("div",ne,[r("div",null,[r("strong",null,p((($=n.driver)==null?void 0:$.name)||"N/A"),1),r("div",oe,p(n.count)+" viajes",1)]),r("div",se," $"+p(Number(n.total).toFixed(2)),1)])]}),_:2},1024)}),128))]),_:1})):(d(),_(P,{key:1,columns:G,data:i.value.by_driver,size:"small"},null,8,["data"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{ce as default};
