import{b as J,C as P,r as i,z as K,d as U,e as t,w as a,v as s,D as j,f as p,A as g,o as f,E as y,q as T,G as O,F as Q,B as W,H as X,h as r,y as C,J as d,k as u,I as L,M as Y,s as N}from"./app-BcChn2R6.js";import{u as Z,b as ee}from"./index-BNShoDAj.js";const ae={class:"drivers-list"},te={style:{display:"flex","justify-content":"space-between","align-items":"center"}},le={style:{display:"flex","justify-content":"space-between"}},ne={style:{display:"flex","justify-content":"space-between"}},ue={__name:"DriversList",setup(se){const c=J(),M=P(),B=Z(ee).smaller("md"),h=i([]),E=i(!1),w=i(""),v=i(!1),x=i(!1),A=i(null),_=i(!1),z=i(null),o=i({name:"",license_number:"",phone:"",is_active:!0}),$={name:{required:!0,message:"Requerido",trigger:["blur","change"]}},q=[{title:"Nombre",key:"name"},{title:"Licencia",key:"license_number"},{title:"Teléfono",key:"phone"},{title:"Estado",key:"is_active",render(n){return N(L,{type:n.is_active?"success":"error"},{default:()=>n.is_active?"Activo":"Inactivo"})}},{title:"Acciones",key:"actions",render(n){return N(y,null,{default:()=>[N(d,{size:"small",onClick:()=>I(n)},{default:()=>"Editar"}),N(d,{size:"small",type:"error",onClick:()=>D(n)},{default:()=>"Eliminar"})]})}}];async function b(){E.value=!0;try{const n={search:w.value},e=await g.get("/drivers",{params:n});h.value=e.data}catch{c.error("Error al cargar conductores")}finally{E.value=!1}}function G(){_.value=!1,z.value=null,o.value={name:"",license_number:"",phone:"",is_active:!0},v.value=!0}function I(n){_.value=!0,z.value=n.id,o.value={name:n.name,license_number:n.license_number,phone:n.phone,is_active:!!n.is_active},v.value=!0}async function S(){var n;(n=A.value)==null||n.validate(async e=>{if(!e){x.value=!0;try{_.value?(await g.put(`/drivers/${z.value}`,o.value),c.success("Conductor actualizado")):(await g.post("/drivers",o.value),c.success("Conductor creado")),v.value=!1,b()}catch{c.error("Error al guardar")}finally{x.value=!1}}})}function D(n){M.warning({title:"Confirmar eliminación",content:"¿Estás seguro de que deseas eliminar este conductor?",positiveText:"Eliminar",negativeText:"Cancelar",onPositiveClick:async()=>{try{await g.delete(`/drivers/${n.id}`),c.success("Conductor eliminado"),b()}catch{c.error("Error al eliminar conductor")}}})}return K(()=>{b()}),(n,e)=>{const m=p("n-input"),V=p("n-data-table"),k=p("n-form-item"),R=p("n-form"),F=p("n-modal");return f(),U("div",ae,[t(s(j),{title:"Conductores"},{"header-extra":a(()=>[t(s(d),{type:"primary",onClick:G},{default:a(()=>[...e[7]||(e[7]=[u(" Nuevo Conductor ",-1)])]),_:1})]),default:a(()=>[t(s(y),{vertical:"",size:"large"},{default:a(()=>[t(m,{value:w.value,"onUpdate:value":e[0]||(e[0]=l=>w.value=l),placeholder:"Buscar conductor",clearable:"",onInput:b,style:{width:"100%"}},null,8,["value"]),s(B)?(f(),T(s(O),{key:0,cols:"1","y-gap":12},{default:a(()=>[(f(!0),U(Q,null,W(h.value,l=>(f(),T(s(X),{key:l.id},{default:a(()=>[t(s(j),{size:"small"},{header:a(()=>[r("div",te,[r("strong",null,C(l.name),1),t(s(L),{type:l.is_active?"success":"error"},{default:a(()=>[u(C(l.is_active?"Activo":"Inactivo"),1)]),_:2},1032,["type"])])]),action:a(()=>[t(s(y),{justify:"end"},{default:a(()=>[t(s(d),{size:"small",onClick:H=>I(l)},{default:a(()=>[...e[10]||(e[10]=[u(" Editar ",-1)])]),_:1},8,["onClick"]),t(s(d),{size:"small",type:"error",onClick:H=>D(l)},{default:a(()=>[...e[11]||(e[11]=[u(" Eliminar ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[t(s(y),{vertical:"",size:"small"},{default:a(()=>[r("div",le,[e[8]||(e[8]=r("span",{style:{color:"#999"}},"Licencia:",-1)),r("span",null,C(l.license_number||"N/A"),1)]),r("div",ne,[e[9]||(e[9]=r("span",{style:{color:"#999"}},"Teléfono:",-1)),r("span",null,C(l.phone||"N/A"),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(f(),T(V,{key:1,columns:q,data:h.value,loading:E.value},null,8,["data","loading"]))]),_:1})]),_:1}),t(F,{show:v.value,"onUpdate:show":e[6]||(e[6]=l=>v.value=l),preset:"card",title:_.value?"Editar Conductor":"Nuevo Conductor",style:{width:"600px"}},{footer:a(()=>[t(s(y),{justify:"end"},{default:a(()=>[t(s(d),{onClick:e[5]||(e[5]=l=>v.value=!1)},{default:a(()=>[...e[14]||(e[14]=[u("Cancelar",-1)])]),_:1}),t(s(d),{type:"primary",loading:x.value,onClick:S},{default:a(()=>[...e[15]||(e[15]=[u(" Guardar ",-1)])]),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(R,{ref_key:"formRef",ref:A,model:o.value,rules:$,"label-placement":s(B)?"top":"left","label-width":"120"},{default:a(()=>[t(k,{label:"Nombre",path:"name"},{default:a(()=>[t(m,{value:o.value.name,"onUpdate:value":e[1]||(e[1]=l=>o.value.name=l),placeholder:"Nombre completo"},null,8,["value"])]),_:1}),t(k,{label:"Licencia",path:"license_number"},{default:a(()=>[t(m,{value:o.value.license_number,"onUpdate:value":e[2]||(e[2]=l=>o.value.license_number=l),placeholder:"Número de licencia"},null,8,["value"])]),_:1}),t(k,{label:"Teléfono",path:"phone"},{default:a(()=>[t(m,{value:o.value.phone,"onUpdate:value":e[3]||(e[3]=l=>o.value.phone=l),placeholder:"Teléfono"},null,8,["value"])]),_:1}),t(k,{label:"Estado",path:"is_active"},{default:a(()=>[t(s(Y),{value:o.value.is_active,"onUpdate:value":e[4]||(e[4]=l=>o.value.is_active=l)},{checked:a(()=>[...e[12]||(e[12]=[u("Activo",-1)])]),unchecked:a(()=>[...e[13]||(e[13]=[u("Inactivo",-1)])]),_:1},8,["value"])]),_:1})]),_:1},8,["model","label-placement"])]),_:1},8,["show","title"])])}}};export{ue as default};
