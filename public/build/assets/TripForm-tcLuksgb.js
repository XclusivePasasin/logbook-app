import{b as $,r as m,c as x,p as A,z as B,d as L,e as a,w as l,f as u,A as v,g as z,o as F,v as T,k as d}from"./app-BcChn2R6.js";import{u as I,b as P}from"./index-BNShoDAj.js";const G={class:"trip-form"},X={__name:"TripForm",setup(J){const _=z(),f=A(),s=$(),V=I(P).smaller("md"),y=m(null),c=m(!1),k=m([]),g=x(()=>!!f.params.id),t=m({trip_date:null,trip_time:null,passengers:1,origin:"",destination:"",payment_method:"E",equipment_number:"",is_ida:!1,is_vuelta:!1,amount:0,driver_id:null,notes:""}),R={trip_date:{required:!0,message:"Requerido",trigger:["blur","change"]},trip_time:{required:!0,message:"Requerido",trigger:["blur","change"]},driver_id:{required:!0,type:"number",message:"Requerido",trigger:["blur","change"]},origin:{required:!0,message:"Requerido",trigger:["blur","change"]},destination:{required:!0,message:"Requerido",trigger:["blur","change"]},amount:{required:!0,type:"number",message:"Requerido",trigger:["blur","change"]}},j=[{label:"Efectivo",value:"E"},{label:"Cargo Habitación",value:"CH"},{label:"Tarjeta",value:"TJ"}],C=x(()=>k.value.map(i=>({label:i.name,value:i.id})));async function H(){try{const i=await v.get("/drivers?active=1");k.value=i.data}catch{s.error("Error al cargar conductores")}}async function M(i){try{const n=(await v.get(`/trips/${i}`)).data;n.trip_date&&(n.trip_date=n.trip_date.split("T")[0]),n.trip_time&&n.trip_time.includes(":")&&(n.trip_time=n.trip_time.substring(0,5)),n.is_ida=!!n.is_ida,n.is_vuelta=!!n.is_vuelta,n.amount=Number(n.amount),t.value=n}catch{s.error("Error al cargar viaje"),_.push({name:"trips.index"})}}async function N(){var i;(i=y.value)==null||i.validate(async e=>{var n,o;if(!e){c.value=!0;try{g.value?(await v.put(`/trips/${f.params.id}`,t.value),s.success("Viaje actualizado")):(await v.post("/trips",t.value),s.success("Viaje creado")),_.push({name:"trips.index"})}catch(b){(o=(n=b.response)==null?void 0:n.data)!=null&&o.errors?s.error("Error de validación"):s.error("Error al guardar")}finally{c.value=!1}}})}return B(async()=>{if(await H(),g.value)await M(f.params.id);else{const i=new Date;t.value.trip_date=i.toISOString().split("T")[0],t.value.trip_time=i.toTimeString().slice(0,5)}}),(i,e)=>{const n=u("n-date-picker"),o=u("n-form-item-gi"),b=u("n-time-picker"),q=u("n-select"),h=u("n-input-number"),p=u("n-input"),w=u("n-checkbox"),U=u("n-space"),S=u("n-grid"),E=u("n-button"),D=u("n-form"),O=u("n-card");return F(),L("div",G,[a(O,{title:g.value?"Editar Viaje":"Nuevo Viaje"},{default:l(()=>[a(D,{ref_key:"formRef",ref:y,model:t.value,rules:R,"label-placement":T(V)?"top":"left","label-width":"160","require-mark-placement":"right-hanging"},{default:l(()=>[a(S,{cols:"1 s:1 m:2 l:2",responsive:"screen","x-gap":24,"y-gap":12},{default:l(()=>[a(o,{label:"Fecha",path:"trip_date"},{default:l(()=>[a(n,{"formatted-value":t.value.trip_date,"onUpdate:formattedValue":e[0]||(e[0]=r=>t.value.trip_date=r),"value-format":"yyyy-MM-dd",type:"date",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),a(o,{label:"Hora",path:"trip_time"},{default:l(()=>[a(b,{"formatted-value":t.value.trip_time,"onUpdate:formattedValue":e[1]||(e[1]=r=>t.value.trip_time=r),"value-format":"HH:mm",format:"HH:mm",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),a(o,{label:"Conductor",path:"driver_id"},{default:l(()=>[a(q,{value:t.value.driver_id,"onUpdate:value":e[2]||(e[2]=r=>t.value.driver_id=r),options:C.value,placeholder:"Seleccione conductor",filterable:""},null,8,["value","options"])]),_:1}),a(o,{label:"Pasajeros",path:"passengers"},{default:l(()=>[a(h,{value:t.value.passengers,"onUpdate:value":e[3]||(e[3]=r=>t.value.passengers=r),min:"1",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{label:"Origen",path:"origin"},{default:l(()=>[a(p,{value:t.value.origin,"onUpdate:value":e[4]||(e[4]=r=>t.value.origin=r),placeholder:"Lugar de salida"},null,8,["value"])]),_:1}),a(o,{label:"Destino",path:"destination"},{default:l(()=>[a(p,{value:t.value.destination,"onUpdate:value":e[5]||(e[5]=r=>t.value.destination=r),placeholder:"Lugar de llegada"},null,8,["value"])]),_:1}),a(o,{label:"Método de Pago",path:"payment_method"},{default:l(()=>[a(q,{value:t.value.payment_method,"onUpdate:value":e[6]||(e[6]=r=>t.value.payment_method=r),options:j},null,8,["value"])]),_:1}),a(o,{label:"Monto",path:"amount"},{default:l(()=>[a(h,{value:t.value.amount,"onUpdate:value":e[7]||(e[7]=r=>t.value.amount=r),precision:2,min:0,style:{width:"100%"}},{prefix:l(()=>[...e[13]||(e[13]=[d("$",-1)])]),_:1},8,["value"])]),_:1}),a(o,{label:"Equipo / Carro",path:"equipment_number"},{default:l(()=>[a(p,{value:t.value.equipment_number,"onUpdate:value":e[8]||(e[8]=r=>t.value.equipment_number=r),placeholder:"Número de equipo"},null,8,["value"])]),_:1}),a(o,{label:"Tipo de Viaje"},{default:l(()=>[a(U,null,{default:l(()=>[a(w,{checked:t.value.is_ida,"onUpdate:checked":e[9]||(e[9]=r=>t.value.is_ida=r)},{default:l(()=>[...e[14]||(e[14]=[d(" IDA ",-1)])]),_:1},8,["checked"]),a(w,{checked:t.value.is_vuelta,"onUpdate:checked":e[10]||(e[10]=r=>t.value.is_vuelta=r)},{default:l(()=>[...e[15]||(e[15]=[d(" VUELTA ",-1)])]),_:1},8,["checked"])]),_:1})]),_:1}),a(o,{span:2,label:"Notas",path:"notes"},{default:l(()=>[a(p,{value:t.value.notes,"onUpdate:value":e[11]||(e[11]=r=>t.value.notes=r),type:"textarea",placeholder:"Notas adicionales"},null,8,["value"])]),_:1})]),_:1}),a(U,{justify:"end"},{default:l(()=>[a(E,{onClick:e[12]||(e[12]=r=>T(_).back())},{default:l(()=>[...e[16]||(e[16]=[d("Cancelar",-1)])]),_:1}),a(E,{type:"primary",loading:c.value,onClick:N},{default:l(()=>[...e[17]||(e[17]=[d(" Guardar ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","label-placement"])]),_:1},8,["title"])])}}};export{X as default};
