import{b as K,C as Q,r as f,z as W,d as b,e as s,w as n,v as l,D as P,A as B,g as X,f as c,o as u,E as v,q as g,t as C,G as Y,F as Z,B as ee,H as te,h as o,y as d,I as _,k as p,J as k,K as V,L as ae,s as h}from"./app-BcChn2R6.js";import{u as ne,b as le}from"./index-BNShoDAj.js";const se={class:"trips-list"},oe={key:0},ie={style:{display:"flex","justify-content":"space-between","align-items":"center"}},re={style:{display:"flex","justify-content":"space-between"}},ue={style:{display:"flex","justify-content":"space-between"}},de={style:{display:"flex","justify-content":"space-between"}},pe={style:{display:"flex","justify-content":"space-between"}},me={style:{"font-size":"16px","font-weight":"bold",color:"#18a058"}},ye={style:{display:"flex","justify-content":"space-between","align-items":"center"}},fe={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ce={key:2,style:{color:"#999"}},be={__name:"TripsList",setup(ve){const j=X(),w=K(),H=Q(),M=ne(le).smaller("md");function $(t){return"info"}function U(t){return{E:"Efectivo",CH:"Cargo Hab.",TJ:"Tarjeta"}[t]||t}const z=f([]),x=f(!1),m=f("day"),T=f(null),i=f({search:"",date:null,month:null}),F=[{label:"Por Día",value:"day"},{label:"Por Mes",value:"month"}],r=f({page:1,pageSize:15,itemCount:0}),L=[{title:"Fecha",key:"trip_date",render(t){return V(new Date(t.trip_date),"dd/MM/yyyy")}},{title:"Hora",key:"trip_time"},{title:"Conductor",key:"driver.name"},{title:"Origen",key:"origin"},{title:"Destino",key:"destination"},{title:"Pasajeros",key:"passengers"},{title:"Pago",key:"payment_method",render(t){const e={E:"Efectivo",CH:"Cargo Hab.",TJ:"Tarjeta"};return h(_,{type:"info"},{default:()=>e[t.payment_method]})}},{title:"Monto",key:"amount",render(t){return`$${t.amount}`}},{title:"Acciones",key:"actions",render(t){return h(v,null,{default:()=>[h(k,{size:"small",onClick:()=>j.push({name:"trips.edit",params:{id:t.id}})},{default:()=>"Editar"}),h(k,{size:"small",type:"error",onClick:()=>N(t)},{default:()=>"Eliminar"})]})}}];function S(){T.value=null,i.value.date=null,i.value.month=null,y()}function A(t){m.value==="day"?(i.value.date=t,i.value.month=null):(i.value.month=t,i.value.date=null),y()}async function y(){x.value=!0;try{const t={page:r.value.page,per_page:r.value.pageSize,search:i.value.search};i.value.date?t.date=i.value.date:i.value.month&&(t.month=i.value.month);const e=await B.get("/trips",{params:t});z.value=e.data.data,r.value.itemCount=e.data.total,r.value.page=e.data.current_page}catch{w.error("Error al cargar viajes")}finally{x.value=!1}}function D(t){r.value.page=t,y()}function N(t){H.warning({title:"Confirmar eliminación",content:"¿Estás seguro de que deseas eliminar este viaje?",positiveText:"Eliminar",negativeText:"Cancelar",onPositiveClick:async()=>{try{await B.delete(`/trips/${t.id}`),w.success("Viaje eliminado"),y()}catch{w.error("Error al eliminar viaje")}}})}return W(()=>{y()}),(t,e)=>{const I=c("n-select"),E=c("n-form-item"),G=c("n-date-picker"),J=c("n-input"),O=c("n-form"),q=c("n-data-table");return u(),b("div",se,[s(l(P),{title:"Bitácora de Viajes"},{"header-extra":n(()=>[s(l(k),{type:"primary",onClick:e[0]||(e[0]=a=>l(j).push({name:"trips.create"}))},{default:n(()=>[...e[4]||(e[4]=[p(" Nuevo Viaje ",-1)])]),_:1})]),default:n(()=>[s(l(v),{vertical:"",size:"large"},{default:n(()=>[s(O,{inline:!l(M),model:i.value,"label-placement":"left"},{default:n(()=>[s(E,{label:"Filtrar por"},{default:n(()=>[s(I,{value:m.value,"onUpdate:value":[e[1]||(e[1]=a=>m.value=a),S],options:F,style:{width:"150px"}},null,8,["value"])]),_:1}),s(E,{label:m.value==="day"?"Día":"Mes"},{default:n(()=>[s(G,{"formatted-value":T.value,"onUpdate:formattedValue":[e[2]||(e[2]=a=>T.value=a),A],type:m.value==="day"?"date":"month","value-format":m.value==="day"?"yyyy-MM-dd":"yyyy-MM",clearable:"",style:{width:"100%"}},null,8,["formatted-value","type","value-format"])]),_:1},8,["label"]),s(E,{label:"Buscar"},{default:n(()=>[s(J,{value:i.value.search,"onUpdate:value":e[3]||(e[3]=a=>i.value.search=a),placeholder:"Origen o Destino",clearable:"",onInput:y,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["inline","model"]),l(M)?(u(),b("div",oe,[s(l(Y),{cols:"1","y-gap":12},{default:n(()=>[(u(!0),b(Z,null,ee(z.value,a=>(u(),g(l(te),{key:a.id},{default:n(()=>[s(l(P),{size:"small"},{header:n(()=>[o("div",ie,[o("span",null,d(l(V)(new Date(a.trip_date),"dd/MM/yyyy")),1),s(l(_),{type:$(a.payment_method)},{default:n(()=>[p(d(U(a.payment_method)),1)]),_:2},1032,["type"])])]),action:n(()=>[s(l(v),{justify:"end"},{default:n(()=>[s(l(k),{size:"small",onClick:R=>l(j).push({name:"trips.edit",params:{id:a.id}})},{default:n(()=>[...e[13]||(e[13]=[p(" Editar ",-1)])]),_:1},8,["onClick"]),s(l(k),{size:"small",type:"error",onClick:R=>N(a)},{default:n(()=>[...e[14]||(e[14]=[p(" Eliminar ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:n(()=>[s(l(v),{vertical:"",size:"small"},{default:n(()=>[o("div",re,[e[5]||(e[5]=o("strong",null,"Hora:",-1)),o("span",null,d(a.trip_time),1)]),o("div",ue,[e[6]||(e[6]=o("strong",null,"Conductor:",-1)),o("span",null,d(a.driver.name),1)]),o("div",de,[e[7]||(e[7]=o("strong",null,"Ruta:",-1)),o("span",null,d(a.origin)+" -> "+d(a.destination),1)]),o("div",pe,[e[8]||(e[8]=o("strong",null,"Monto:",-1)),o("span",me,"$"+d(a.amount),1)]),o("div",ye,[e[9]||(e[9]=o("strong",null,"Pasajeros:",-1)),s(l(_),{type:"info",size:"small"},{default:n(()=>[p(d(a.passengers),1)]),_:2},1024)]),o("div",fe,[e[12]||(e[12]=o("strong",null,"Tipo:",-1)),s(l(v),{size:"small"},{default:n(()=>[a.is_ida?(u(),g(l(_),{key:0,type:"success",size:"small"},{default:n(()=>[...e[10]||(e[10]=[p("IDA",-1)])]),_:1})):C("",!0),a.is_vuelta?(u(),g(l(_),{key:1,type:"warning",size:"small"},{default:n(()=>[...e[11]||(e[11]=[p("VUELTA",-1)])]),_:1})):C("",!0),!a.is_ida&&!a.is_vuelta?(u(),b("span",ce,"-")):C("",!0)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),r.value.itemCount>0?(u(),g(l(ae),{key:0,style:{"margin-top":"12px","justify-content":"center"},"item-count":r.value.itemCount,page:r.value.page,"page-size":r.value.pageSize,"onUpdate:page":D},null,8,["item-count","page","page-size"])):C("",!0)])):(u(),g(q,{key:1,columns:L,data:z.value,loading:x.value,pagination:r.value,"onUpdate:page":D},null,8,["data","loading","pagination"]))]),_:1})]),_:1})])}}};export{be as default};
